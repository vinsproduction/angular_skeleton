var app;app=angular.module("app",["ngRoute","ngCookies","appControllers","appDirectives","appServices"]),angular.element(document).ready(function(){return angular.bootstrap(document,["app"]),window.console.info("[App loaded] APP: ",app.APP)}),app.APP=function(){var opt,port,url;return opt={project:"Angular Skeleton",debug:/debug/.test(window.location.search),local:""===window.location.host||/localhost/.test(window.location.host),host:window.location.protocol+"//"+window.location.host,remoteHost:"http://vinsproduction.com",root:""},window.WebSocket&&/localhost/.test(window.location.host)&&(port=777,url="http://localhost:"+port+"/livereload.js",window.document.write('<script type="text/javascript" src="'+url+'"></script>'),console.debug("[LiveReload] "+url)),opt}(),app.constant("APP",function(){return app.APP}()),app.setApp=function(key,val){return app.constant("APP",function(){return app.APP[key]=val,app.APP}())},app.config(["$interpolateProvider",function($interpolateProvider){return $interpolateProvider.startSymbol("[["),$interpolateProvider.endSymbol("]]"),0}]),app.run(["$route","$rootScope","$location",function($route,$rootScope,$location){var original;return original=$location.path,$location.path=function(path,reload){var lastRoute,un;return reload===!1&&(lastRoute=$route.current,un=$rootScope.$on("$locationChangeSuccess",function(){return $route.current=lastRoute,un()})),original.apply($location,[path])}}]),app.config(["$routeProvider",function(){}]);var appControllers;appControllers=angular.module("appControllers",[]),appControllers.controller("headCtrl",["$rootScope",function(){}]),appControllers.controller("bodyCtrl",["APP","$rootScope","$location",function(){}]),appControllers.controller("popupsCtrl",["APP","$rootScope","$scope","$location",function(){}]),appControllers.controller("homeCtrl",["APP","$rootScope","$scope","$location",function(APP,$rootScope){return $rootScope.title="home"}]);var appDirectives;appDirectives=angular.module("appDirectives",[]),appDirectives.directive("placeholderDirective",function(){return{restrict:"A",scope:{},link:function(scope,el,attr){return el=$(el),el.focus(function(){return el.val()===attr.placeholderDirective?el.val(""):void 0}),el.blur(function(){return""===el.val()?el.val(attr.placeholderDirective):void 0}),el.blur()}}});var appServices;appServices=angular.module("appServices",[]),appServices.factory("http",["$http",function($http){var defaultOptions,request;return defaultOptions={log:!0},request=function(options){var log,params,_ref;return null==options&&(options={}),log=null!=(_ref=options.log)?_ref:defaultOptions.log,params=angular.extend({},defaultOptions,options),delete params.log,request=$http(params),request.success(function(response,status,headers,config){return log?console.debug("["+config.method+" "+status+"] "+config.url+" | success:",response,"| config:",config):void 0}),request.error(function(response,status,headers,config){return log?console.error("["+config.method+" "+status+"] "+config.url+" | error:",response,"| config:",config):void 0}),request}}]),appServices.factory("api",["http","APP","$cookieStore",function(http,APP){var request;return request=function(options){var host;return null==options&&(options={}),host=APP.local?APP.remoteHost:APP.host,options.url=host+"/"+options.url,options.xsrfHeaderName="X-CSRFToken",options.xsrfCookieName="csrftoken",options.headers||(options.headers={}),request=http(options),request.success(function(){}),request.error(function(){}),request}}]),appServices.factory("listeners",["scroll","size",function(scroll,size){var Factory,factory;return Factory=function(){function Factory(){var debounced,lastScrollTop,throttled;this.onScroll=function(callback){return $(window).on("AppOnScroll",function(event,v){return callback?callback(v):void 0})},lastScrollTop=0,throttled=_.throttle(function(){var action,isBottom,top,vars;return top=scroll(),top!==lastScrollTop?(isBottom=top+$(window).height()>=$(document).height(),action=top>lastScrollTop?"down":"up",lastScrollTop=top,vars={top:top,isBottom:isBottom,action:action},$(window).trigger("AppOnScroll",[vars])):void 0},100),$(window).scroll(throttled),this.onResize=function(callback){return $(window).on("AppOnResize",function(event,v){return callback?callback(v):void 0})},debounced=_.debounce(function(){return $(window).trigger("AppOnResize",[size])},300),$(window).resize(debounced),_.defer(function(){return $(window).resize()}),this.onHash=function(callback){var set;return set=!1,$(window).on("AppOnHash",function(event,v){return callback?callback(v):void 0}),set?void 0:(callback&&callback(window.location.hash),set=!0)},$(window).on("hashchange",function(){return function(){return $(window).trigger("AppOnHash",[window.location.hash])}}(this)),$(window).trigger("hashchange")}return Factory}(),factory=new Factory}]),appServices.factory("scroll",[function(){return function(v,animate){var callback,easing,el,time;return time=(null!=animate?animate.time:void 0)||800,easing=(null!=animate?animate.easing:void 0)||"linear",callback=!1,null!=v&&_.isString(v)?(el=$(v),el[0]&&_.isElement(el[0])?animate?$("html,body").stop().animate({scrollTop:el.offset().top},time,easing,function(){return!callback&&(callback=!0,animate.done)?animate.done():void 0}):$("html,body").scrollTop(el.offset().top):void 0):null!=v&&v[0]&&_.isElement(v[0])?animate?$("html,body").stop().animate({scrollTop:v.offset().top},time,easing,function(){return!callback&&(callback=!0,animate.done)?animate.done():void 0}):$("html,body").scrollTop(v.offset().top):null!=v?animate?$("html,body").stop().animate({scrollTop:v},time,easing,function(){return!callback&&(callback=!0,animate.done)?animate.done():void 0}):$("html,body").scrollTop(v):$(window).scrollTop()}}]),appServices.factory("size",[function(){return{windowWidth:$(window).width(),windowHeight:$(window).height(),documentWidth:$(document).width(),documentHeight:$(document).height(),bodyWidth:parseInt($("body").width()),bodyHeight:parseInt($("body").height()),mainWidth:parseInt($("body > main").width()),mainHeight:parseInt($("body > main").height()),headerWidth:parseInt($("body > main > header").width()),headerHeight:parseInt($("body > main > header").height()),footerWidth:parseInt($("body > main > footer").width()),footerHeight:parseInt($("body > main > footer").height()),sectionsWidth:parseInt($("body > main > .sections").width()),sectionsHeight:parseInt($("body > main > .sections").height())}}]),appServices.factory("social",["APP",function(){var Social;return new(Social=function(){function Social(){}return Social.prototype.auth={vk:function(callback){return"undefined"==typeof VK||null===VK?console.warn("[App > auth > vk] VK is not defined"):VK.Auth.login(function(r){return r.session?(console.debug("[VKONTAKTE > auth]",r.session.user),callback(r.session.user)):console.error("[VKONTAKTE > auth]",r)})},fb:function(callback){var getUser;return"undefined"==typeof FB||null===FB?console.warn("[App > auth > fb] FB is not defined"):(getUser=function(authResponse){return FB.api("/me",function(r){return _.extend(r,authResponse),console.debug("[FACEBOOK > auth]",r),callback(r)})},FB.getLoginStatus(function(r){return"connected"===r.status?getUser(r.authResponse):FB.login(function(r){return r.authResponse?getUser(r.authResponse):console.error("[FACEBOOK > auth]",r)},{scope:"user_likes"})}))}},Social.prototype.wallPost={vk:function(options){return null==options&&(options={}),"undefined"==typeof VK||null===VK?console.warn("[App > social > wallPost] VK is not defined"):(options.attachLink=options.attachLink?options.attachLink:"",options.attachPhoto=options.attachPhoto?options.attachPhoto:"",VK.api("wall.post",{owner_id:options.owner_id,message:options.message,attachments:""+options.attachPhoto+","+options.attachLink},function(r){return!r||r.error?(console.error("[VKONTAKTE > wall.post]",r),options.error&&options.error(r.error)):(console.debug("[VKONTAKTE > wall.post] success"),options.success&&options.success()),options.allways?options.allways():void 0}))},fb:function(options){return null==options&&(options={}),"undefined"==typeof FB||null===FB?console.warn("[FB > social > wallPost] FB is not defined"):FB.ui({to:options.to,method:"feed",link:options.link||app.social.url,picture:options.picture||"",name:options.name||"",description:options.description||"",caption:options.caption||""},function(r){return r?(console.debug("[socWallPost Facebook] success"),options.success&&options.success()):(console.error("[socWallPost Facebook] error",r),options.error&&options.error()),options.allways?options.allways():void 0})},ok:function(options){var url;return null==options&&(options={}),url=options.url||app.social.url,window.open("http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl="+encodeURIComponent(url)+"&st.comments="+encodeURIComponent(options.comments),"","toolbar=0,status=0,width=626,height=436")}},Social.prototype.share={it:function(){var options;return options={},options.title="title",options.description="description",options.image=""+app.host+"/img/for_post.png",this.facebook(options)},vk:function(options){var url;return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),url="http://vkontakte.ru/share.php?",options.url&&(url+="url="+encodeURIComponent(options.url)),options.title&&(url+="&title="+encodeURIComponent(options.title.substr(0,100))),options.description&&(url+="&description="+encodeURIComponent(options.description.substr(0,100)+"...")),options.image&&(url+="&image="+encodeURIComponent(options.image)),url+="&noparse=true",this.popup(url)},vkCount:function(options){return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),window.VK.share||(window.VK.Share={}),window.VK.Share.count=function(index,count){return console.debug("[VK Share count]",count),options.callback?options.callback(count):void 0},$.getJSON("http://vkontakte.ru/share.php?act=count&index=1&url="+escape(options.url)+"&format=json&callback=?")},ok:function(options){var url;return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),url="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1",options.url&&(url+="&st._surl="+encodeURIComponent(options.url)),options.title&&(url+="&title="+encodeURIComponent(options.title)),options.description&&(url+="&st.comments="+encodeURIComponent(options.description)),this.popup(url)},okCount:function(options){return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),window.ODKL||(window.ODKL={}),window.ODKL.updateCountOC=function(a,count){return console.debug("[OK Share count]",count),options.callback?options.callback(count):void 0},$.getJSON("http://www.odnoklassniki.ru/dk?st.cmd=extOneClickLike&uid=odklocs0&callback=?&ref="+escape(options.url))},fb:function(options){return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),FB.ui({method:"feed",link:options.url,name:options.title?options.title.substr(0,100):void 0,caption:options.description?options.description.substr(0,100)+"...":void 0,picture:options.image?options.image:void 0},function(){})},fbCount:function(options){return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),$.getJSON("http://api.facebook.com/restserver.php?method=links.getStats&callback=?&urls="+escape(options.url)+"&format=json",function(data){return console.debug("[FB Share count]",data[0].share_count),options.callback?options.callback(data[0].share_count):void 0})},tw:function(options){var url;return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),url="http://twitter.com/share?",options.title&&(url+="text="+encodeURIComponent(options.title)),options.url&&(url+="&url="+encodeURIComponent(options.url)),options.url&&(url+="&counturl="+encodeURIComponent(options.url)),this.popup(url)},twCount:function(options){return null==options&&(options={}),options.url||(options.url=app.local?app.remoteHost+window.location.pathname+window.location.hash:window.location.href),$.getJSON("http://urls.api.twitter.com/1/urls/count.json?url="+escape(options.url)+"&callback=?",function(data){return console.debug("[TW Share count]",data.count),options.callback?options.callback(data.count):void 0})},mailru:function(options){var url;return null==options&&(options={}),options.url=options.url||app.social.url,url="http://connect.mail.ru/share?",url+="url="+encodeURIComponent(options.url),url+="&title="+encodeURIComponent(options.title),url+="&description="+encodeURIComponent(options.description),url+="&imageurl="+encodeURIComponent(options.image),this.popup(url)},popup:function(url){return window.open(url,"","toolbar=0,status=0,width=626,height=436")}},Social}())}]);